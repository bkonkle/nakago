"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[423],{1792:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>t});var l=s(4848),c=s(8453);const r={sidebar_position:5},i="Development",a={id:"development",title:"Development",description:"To set up a development environment to build this project, you'll need to install some helpful tools.",source:"@site/docs/development.md",sourceDirName:".",slug:"/development",permalink:"/docs/development",draft:!1,unlisted:!1,editUrl:"https://github.com/bkonkle/nakago/tree/main/website/docs/development.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"documentationSidebar",previous:{title:"Examples",permalink:"/docs/examples"}},d={},t=[{value:"Clippy",id:"clippy",level:2},{value:"pre-commit",id:"pre-commit",level:2},{value:"libclang",id:"libclang",level:2},{value:"Cargo Make",id:"cargo-make",level:2},{value:"Running the Local dev server",id:"running-the-local-dev-server",level:2},{value:"Running Integration Tests",id:"running-integration-tests",level:2},{value:"Update Dependencies",id:"update-dependencies",level:2},{value:"SQLx CLI",id:"sqlx-cli",level:3},{value:"Examples: Docker Build",id:"examples-docker-build",level:2}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"development",children:"Development"})}),"\n",(0,l.jsx)(n.p,{children:"To set up a development environment to build this project, you'll need to install some helpful tools."}),"\n",(0,l.jsx)(n.h2,{id:"clippy",children:"Clippy"}),"\n",(0,l.jsxs)(n.p,{children:["For helpful linting rools, install ",(0,l.jsx)(n.a,{href:"https://github.com/rust-lang/rust-clippy",children:"Clippy"})]}),"\n",(0,l.jsxs)(n.p,{children:["Run it with ",(0,l.jsx)(n.code,{children:"cargo"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo clippy --fix\n"})}),"\n",(0,l.jsxs)(n.p,{children:["If you're using VS Code, configure the ",(0,l.jsx)(n.code,{children:"rust-analyzer"})," plugin to use it (in ",(0,l.jsx)(n.em,{children:"settings.json"}),"):"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "rust-analyzer.checkOnSave.command": "clippy"\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"pre-commit",children:"pre-commit"}),"\n",(0,l.jsx)(n.p,{children:"Install pre-commit to automatically set up Git hook scripts."}),"\n",(0,l.jsxs)(n.p,{children:["In Ubuntu, the package to install is ",(0,l.jsx)(n.code,{children:"pre-commit"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"sudo apt install pre-commit\n"})}),"\n",(0,l.jsxs)(n.p,{children:["In Arch Linux, sync ",(0,l.jsx)(n.code,{children:"pre-commit"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"pacman -S pre-commit\n"})}),"\n",(0,l.jsxs)(n.p,{children:["On Mac with Homebrew, the package is also ",(0,l.jsx)(n.code,{children:"pre-commit"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"brew install pre-commit\n"})}),"\n",(0,l.jsx)(n.h2,{id:"libclang",children:"libclang"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"cargo-spellcheck"})," utility depends on ",(0,l.jsx)(n.a,{href:"https://clang.llvm.org/doxygen/group__CINDEX.html",children:(0,l.jsx)(n.code,{children:"libclang"})}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["In Ubuntu, the package to install is ",(0,l.jsx)(n.code,{children:"libclang-dev"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"sudo apt install libclang-dev\n"})}),"\n",(0,l.jsxs)(n.p,{children:["In Arch Linux, sync ",(0,l.jsx)(n.code,{children:"clang"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"pacman -S clang\n"})}),"\n",(0,l.jsx)(n.h2,{id:"cargo-make",children:"Cargo Make"}),"\n",(0,l.jsxs)(n.p,{children:["To use build scripts from the ",(0,l.jsx)(n.em,{children:"Makefile.toml"}),", install Cargo Make:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo install cargo-make\n"})}),"\n",(0,l.jsx)(n.p,{children:'Run "setup" to install some tooling dependencies:'}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make setup\n"})}),"\n",(0,l.jsx)(n.h2,{id:"running-the-local-dev-server",children:"Running the Local dev server"}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"cargo"})," to run the dev server locally:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make dev\n"})}),"\n",(0,l.jsx)(n.h2,{id:"running-integration-tests",children:"Running Integration Tests"}),"\n",(0,l.jsxs)(n.p,{children:["First, create a ",(0,l.jsx)(n.code,{children:".envrc"})," file by copying ",(0,l.jsx)(n.code,{children:".envrc.example"}),", and run ",(0,l.jsx)(n.code,{children:"direnv allow"})," to load the environment variables."]}),"\n",(0,l.jsx)(n.p,{children:"Then spin up the supporting Docker Compose processes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make docker up -d\n"})}),"\n",(0,l.jsx)(n.p,{children:"Now you can reset the test DB:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make db-reset\n"})}),"\n",(0,l.jsx)(n.p,{children:"And then run the integration tests:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make integration\n"})}),"\n",(0,l.jsx)(n.h2,{id:"update-dependencies",children:"Update Dependencies"}),"\n",(0,l.jsxs)(n.p,{children:["First, install the ",(0,l.jsx)(n.code,{children:"outdated"})," command for ",(0,l.jsx)(n.code,{children:"cargo"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo install cargo-outdated\n"})}),"\n",(0,l.jsx)(n.p,{children:"Then, update and check for any major dependency changes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo update\ncargo outdated\n"})}),"\n",(0,l.jsx)(n.h3,{id:"sqlx-cli",children:"SQLx CLI"}),"\n",(0,l.jsx)(n.p,{children:"The cargo-make setup task installs the SQLx CLI for running database migrations for the example projects."}),"\n",(0,l.jsxs)(n.p,{children:["Create a database based on the ",(0,l.jsx)(n.code,{children:"DATABASE_URL"})," in the ",(0,l.jsx)(n.code,{children:".envrc"}),", if you haven't already:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make db-create\n"})}),"\n",(0,l.jsx)(n.p,{children:"Run migrations:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make db-migrate\n"})}),"\n",(0,l.jsx)(n.p,{children:"If you want to wipe your database and start over:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"cargo make db-reset\n"})}),"\n",(0,l.jsx)(n.h2,{id:"examples-docker-build",children:"Examples: Docker Build"}),"\n",(0,l.jsx)(n.p,{children:"To build locally, use Buildkit:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"DOCKER_BUILDKIT=1 docker build -t async-graphql -f examples/async-graphql/Dockerfile .\n"})}),"\n",(0,l.jsx)(n.p,{children:"To clear the build cache:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"docker builder prune --filter type=exec.cachemount\n"})}),"\n",(0,l.jsx)(n.p,{children:"To inspect the local filesystem:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"docker run --rm -it --entrypoint=/bin/bash async-graphql\n"})}),"\n",(0,l.jsx)(n.p,{children:"To inspect the full build context:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"docker image build --no-cache -t build-context -f - . <<EOF\nFROM busybox\nWORKDIR /build-context\nCOPY . .\nCMD find .\nEOF\n\ndocker container run --rm build-context\n"})}),"\n",(0,l.jsx)(n.p,{children:"And to clean up the build context test image:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"docker image rm build-context\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var l=s(6540);const c={},r=l.createContext(c);function i(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);